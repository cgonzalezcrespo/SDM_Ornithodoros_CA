---
title: "R Notebook"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r}
#knitr::opts_chunk$set(warning = F, message = F)
library(sdm)
library(sp)
library(mapview)
library(dismo)
library(dplyr)
library(tidyr)
library(raster)
library(rmarkdown)
library(parallel)
library(ENMTools)
library(usdm)
library(RColorBrewer) 
library(rasterVis)    
library(ggplot2)      
library(colorspace)
library(readr)
library(sf)
library(rasterVis)
```


```{r}
setwd("C:/Users/carlo/Desktop/CADMS/proyectos/SDM/Soft tick presence/resources/SDM model")
options(java.parameters = "-Xmx8g") ### Meaning: how many Gb will use the console

```


```{r}
weather_p<-stack(list.files("./weather2", "*tif$",full.names = T))
weather_f<-stack(list.files("./CaliFuture", "*tif$",full.names = T))
names(weather_p)

Orientation <- raster("orientation11.tif")
LandCover <- stack(list.files("./landcover", "*tif$",full.names = T))

#edaphic
soil_type <- stack(list.files("./SoilsR", "*tif$",full.names = T))
rock_type <- stack(list.files("./RocksR", "*tif$",full.names = T))
edaphS <- stack(rock_type,soil_type)

#topographic
Elevation <- raster("Elevation2.tif")
Slope <- raster("Slope.tif")
Waterdistance<-raster("DistancetoWater2.tif")
topoS <- stack(Elevation,Slope,Waterdistance, Orientation )
names(topoS)
```

```{r}
guaracoria<-read.csv("O.Cdef.csv",sep=";") # this is the species list
guaracoria2<-read.csv("Gbifrefsage_coria2.csv",sep=",") 

guarahermsi<-read.csv("Gbifrefsage_hermsi.csv",sep=",") # this is the species list
guaraparkeri<-read.csv("Gbifrefsage_otros.csv",sep=",") # this is the species 

#guarasus<-read.csv("./Susscrofa/SusCA.csv",sep=",") # this is the species list

# Now only maintain lon and lat coordinates:
guarac<-select(guaracoria,lon,lat)
guarac2<-select(guaracoria2,lon,lat)
guarah<-select(guarahermsi,lon,lat)
guarap<-select(guaraparkeri,lon,lat)

# And remove occurrences with no lon and lat:
#guarac<-drop_na(guarac)
# Create a "species" variable. We will use this later. It is just a column full of 1.
guarac$Occurrence<-1
guarac2$Occurrence<-1
guarah$Occurrence<-1
guarap$Occurrence<-1
#guaras$Occurrence<-1

# Now transform these occurrences into a spatial object:
coordinates(guarac2)<- c("lon","lat")
coordinates(guarac)<- c("lon","lat")
coordinates(guarah)<- c("lon","lat")
coordinates(guarap)<- c("lon","lat")
#coordinates(guaras)<- c("lon","lat")

guarax<-guarac+guarah+guarap
guarax2<-guarac2+guarah+guarap

guaracoria3<-read.csv("ocoriaceus3.csv",sep=",") 
guaracoria3<-read.csv("ocoriaceus4.csv",sep=",") 
guarac3<-select(guaracoria3,lon,lat)
guarac3$Occurrence<-1
coordinates(guarac3)<- c("lon","lat")
guarax3<-guarac3+guarah+guarap
```

```{r}
predP<-stack(weather_p,edaphS,LandCover,topoS)
prepP<-raster::extract(predP,guarax)
vpP<-vifstep(prepP,th=10.0)
preP<-exclude(predP,vpP)
names(preP)
prepc<-raster::extract(weather_p,guarax)
prepf<-raster::extract(weather_f,guarax)
prept<-raster::extract(topoS,guarax)
preps<-raster::extract(soil_type,guarax)
prepr<-raster::extract(rock_type,guarax)
prepl<-raster::extract(LandCover,guarax)
prepe<-raster::extract(edaphS,guarax)

vpc<-vifstep(prepc,th=10.0)
vpf<-vifstep(prepf,th=10.0)
vpt<-vifstep(prept,th=10.0)
vps<-vifstep(preps,th=10.0)
vpr<-vifstep(prepr,th=10.0)
vpl<-vifstep(prepl,th=10.0)
vpe<-vifstep(prepe,th=10.0)

predsPc1<-exclude(weather_p,vpc)
predsF<-exclude(weather_f,vpf)
predsPt<-exclude(topoS,vpt)
predsPs<-exclude(soil_type,vps)
predsPr<-exclude(rock_type,vpr)
predsPl<-exclude(LandCover,vpl)
predsPe<-exclude(edaphS,vpe)
names(predsPe)

PredictorsP<- stack(predsPc1,predsPt,predsPs,predsPr,predsPl)
names(PredictorsP)
PredictorsF<- stack(predsF,predsPt,predsPs,predsPr,predsPl)
names(PredictorsF)

```


Variables exploration
O. coriaceus
```{r}
DPc1 <- sdmData(Occurrence~., train=guarac, predictors=predsPc1,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc2 <- sdmData(Occurrence~., train=guarac, predictors=predsPt,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc3 <- sdmData(Occurrence~., train=guarac, predictors=predsPs,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc4 <- sdmData(Occurrence~., train=guarac, predictors=predsPr,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc5 <- sdmData(Occurrence~., train=guarac, predictors=predsPl,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc6 <- sdmData(Occurrence~., train=guarac, predictors=predsPe,
               bg = list(method="gRandom", n=10000, remove=TRUE))

MPc1 <- sdm(Occurrence~.,data=DPc1,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc2 <- sdm(Occurrence~.,data=DPc2,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc3 <- sdm(Occurrence~.,data=DPc3,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc4 <- sdm(Occurrence~.,data=DPc4,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc5 <- sdm(Occurrence~.,data=DPc5,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc6 <- sdm(Occurrence~.,data=DPc6,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MPc1),'auc', main="MaxEnt present")
plot(getVarImp(MPc2),'auc', main="MaxEnt present")
plot(getVarImp(MPc3),'auc', main="MaxEnt present")
plot(getVarImp(MPc4),'auc', main="MaxEnt present")
plot(getVarImp(MPc5),'auc', main="MaxEnt present")
plot(getVarImp(MPc6),'auc', main="MaxEnt present")
#gui(MPc)
roc(MPc1)
roc(MPc2)
roc(MPc3)
roc(MPc4)
roc(MPc5)
roc(MPc6)
```


```{r}
PPm <- dropLayer(PredictorsP, c(3,4,5,7,12,13,16:25,28:32,34:36,38,40,41))
PPm1<-dropLayer(PPm, c(1,4,5,7,10,12,13))
PPm2<-dropLayer(PPm1, c(6))
summary(DPcx)
names(PPm)
DPcx <- sdmData(Occurrence~., train=guarac, predictors=PPm1,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MPcx <- sdm(Occurrence~.,data=DPcx,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MPcx),'auc', main="MaxEnt present")
vi<-getVarImp(MPcx)
vi
roc(MPcx)
rcurve(MPcx)

```

O. hermsi
```{r}
DPc11 <- sdmData(Occurrence~., train=guarah, predictors=predsPc1,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc12 <- sdmData(Occurrence~., train=guarah, predictors=predsPt,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc13 <- sdmData(Occurrence~., train=guarah, predictors=predsPs,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc14 <- sdmData(Occurrence~., train=guarah, predictors=predsPr,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc15 <- sdmData(Occurrence~., train=guarah, predictors=predsPl,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc16 <- sdmData(Occurrence~., train=guarah, predictors=predsPe,
               bg = list(method="gRandom", n=10000, remove=TRUE))

MPc11 <- sdm(Occurrence~.,data=DPc11,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc12 <- sdm(Occurrence~.,data=DPc12,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc13 <- sdm(Occurrence~.,data=DPc13,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc14 <- sdm(Occurrence~.,data=DPc14,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc15 <- sdm(Occurrence~.,data=DPc15,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc16 <- sdm(Occurrence~.,data=DPc16,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MPc11),'auc', main="MaxEnt present")
plot(getVarImp(MPc12),'auc', main="MaxEnt present")
plot(getVarImp(MPc13),'auc', main="MaxEnt present")
plot(getVarImp(MPc14),'auc', main="MaxEnt present")
plot(getVarImp(MPc15),'auc', main="MaxEnt present")
plot(getVarImp(MPc16),'auc', main="MaxEnt present")
#gui(MPc)
roc(MPc11)
roc(MPc12)
roc(MPc13)
roc(MPc14)
roc(MPc15)
roc(MPc16)
```

```{r}
PredictorH2<-dropLayer(PredictorsP, c(2:5,9,11,12,13,15,16,17,19,21:25,28:32,34:36,40,41))
names(PredictorH2)

DPcy <- sdmData(Occurrence~., train=guarah, predictors=PredictorH2,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MPcy <- sdm(Occurrence~.,data=DPcy,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MPcy),'auc', main="MaxEnt present")
vi2<-getVarImp(MPcy)
vi2
roc(MPcy)
rcurve(MPcy)
```

O. parkeri
```{r}
DPc111 <- sdmData(Occurrence~., train=guarap, predictors=predsPc1,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc121 <- sdmData(Occurrence~., train=guarap, predictors=predsPt,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc131 <- sdmData(Occurrence~., train=guarap, predictors=predsPs,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc141 <- sdmData(Occurrence~., train=guarap, predictors=predsPr,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc151 <- sdmData(Occurrence~., train=guarap, predictors=predsPl,
               bg = list(method="gRandom", n=10000, remove=TRUE))
DPc161 <- sdmData(Occurrence~., train=guarap, predictors=predsPe,
               bg = list(method="gRandom", n=10000, remove=TRUE))

MPc111 <- sdm(Occurrence~.,data=DPc111,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc121 <- sdm(Occurrence~.,data=DPc121,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc131 <- sdm(Occurrence~.,data=DPc131,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc141 <- sdm(Occurrence~.,data=DPc141,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc151 <- sdm(Occurrence~.,data=DPc151,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MPc161 <- sdm(Occurrence~.,data=DPc161,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MPc111),'auc', main="MaxEnt present")
plot(getVarImp(MPc121),'auc', main="MaxEnt present")
plot(getVarImp(MPc131),'auc', main="MaxEnt present")
plot(getVarImp(MPc141),'auc', main="MaxEnt present")
plot(getVarImp(MPc151),'auc', main="MaxEnt present")
plot(getVarImp(MPc161),'auc', main="MaxEnt present")
#gui(MPc)
roc(MPc111)
roc(MPc121)
roc(MPc131)
roc(MPc141)
roc(MPc151)
roc(MPc161)

```

```{r}

Predictorp2<-dropLayer(PredictorsP, c(3:5,7,11:14,16:25,27,28,31,32,34, 36:38, 40,41))
names(Predictorp2)

DPcz <- sdmData(Occurrence~., train=guarap, predictors=Predictorp2,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MPcz <- sdm(Occurrence~.,data=DPcz,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

plot(getVarImp(MPcz),'auc', main="MaxEnt present")
vi3<-getVarImp(MPcz)
vi3
roc(MPcz)
rcurve(MPcz)
```

Future
```{r}
DFc1 <- sdmData(Occurrence~., train=guarac, predictors=predsF,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFc1 <- sdm(Occurrence~.,data=DFc1,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFh1 <- sdmData(Occurrence~., train=guarah, predictors=predsF,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFh1 <- sdm(Occurrence~.,data=DFh1,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFp1 <- sdmData(Occurrence~., train=guarap, predictors=predsF,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFp1 <- sdm(Occurrence~.,data=DFp1,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MFc1),'auc', main="MaxEnt future")
plot(getVarImp(MFh1),'auc', main="MaxEnt future")
plot(getVarImp(MFp1),'auc', main="MaxEnt future")
#gui(MPc)
roc(MFc1)
roc(MFh1)
roc(MFp1)
```


```{r}
names(PredictorF)
PredictorFc<-dropLayer(PredictorF, c(3:5,7,11:14,16:25,28:32,34:36,38,40,41))
names(PredictorFc)
PredictorFh<-dropLayer(PredictorF, c(2:5,9,11,12,13,15:17,19,20:24,28:32,34,35,36, 40,41))
names(PredictorFh)
PredictorFp<-dropLayer(PredictorF, c(3:5,7,11:14,16:25,27,28,31,32,34, 36:38, 40,41))
names(PredictorFp)

```

```{r}
DFc1x <- sdmData(Occurrence~., train=guarac2, predictors=PredictorFc,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFc1x <- sdm(Occurrence~.,data=DFc1x,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFh1x <- sdmData(Occurrence~., train=guarah, predictors=PredictorFh,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFh1x <- sdm(Occurrence~.,data=DFh1x,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFp1x <- sdmData(Occurrence~., train=guarap, predictors=PredictorFp,
               bg = list(method="gRandom", n=10000, remove=TRUE))
MFp1x <- sdm(Occurrence~.,data=DFp1x,methods=c('maxent'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MFc1x),'auc', main="MaxEnt future")
plot(getVarImp(MFh1x),'auc', main="MaxEnt future")
plot(getVarImp(MFp1x),'auc', main="MaxEnt future")
vi4<-getVarImp(MFc1x)
vi5<-getVarImp(MFh1x)
vi6<-getVarImp(MFp1x)
vi6
vi5
vi4
roc(MFc1x)
roc(MFh1x)
roc(MFp1x)
```

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Random Forest
O. coriaceus
```{r}

RPc1 <- sdmData(Occurrence~., train=guarac, predictors=predsPc1,
               bg = list(method="gRandom", n=15, remove=TRUE))
RPc2 <- sdmData(Occurrence~., train=guarac, predictors=predsPt,
               bg = list(method="gRandom", n=15, remove=TRUE))
RPc3 <- sdmData(Occurrence~., train=guarac, predictors=predsPs,
               bg = list(method="gRandom", n=15, remove=TRUE))
RPc4 <- sdmData(Occurrence~., train=guarac, predictors=predsPr,
               bg = list(method="gRandom", n=15, remove=TRUE))
RPc5 <- sdmData(Occurrence~., train=guarac, predictors=predsPl,
               bg = list(method="gRandom", n=15, remove=TRUE))

MRPc1 <- sdm(Occurrence~.,data=RPc1,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc2 <- sdm(Occurrence~.,data=RPc2,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc3 <- sdm(Occurrence~.,data=RPc3,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc4 <- sdm(Occurrence~.,data=RPc4,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc5 <- sdm(Occurrence~.,data=RPc5,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPc1),'auc', main="RF present")
plot(getVarImp(MRPc2),'auc', main="RF present")
plot(getVarImp(MRPc3),'auc', main="RF present")
plot(getVarImp(MRPc4),'auc', main="RF present")
plot(getVarImp(MRPc5),'auc', main="RF present")

#gui(MPc)
roc(MRPc1)
roc(MRPc2)
roc(MRPc3)
roc(MRPc4)
roc(MRPc5)
```


```{r}
names(PredictorsP)
PPm <- dropLayer(PredictorsP, c(1,2,4,5,7,12,13,14,16,19:25,27:32,34:36,38,40,41))
names(PPm)
PPm1<-dropLayer(PPm, c(11:13))
PPm2<-dropLayer(PPm1, c(6))


```

```{r}
RPcx <- sdmData(Occurrence~., train=guarac2, predictors=PPm1,
               bg = list(method="gRandom", n=15, remove=TRUE))
MRPcx <- sdm(Occurrence~.,data=RPcx,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPcx),'auc', main="RF present")
vi7<-getVarImp(MRPcx)
vi7
roc(MRPcx)
```



O. hermsi
```{r}
RPc11 <- sdmData(Occurrence~., train=guarah, predictors=predsPc1,
               bg = list(method="gRandom", n=65, remove=TRUE))
RPc21 <- sdmData(Occurrence~., train=guarah, predictors=predsPt,
               bg = list(method="gRandom", n=65, remove=TRUE))
RPc31 <- sdmData(Occurrence~., train=guarah, predictors=predsPs,
               bg = list(method="gRandom", n=65, remove=TRUE))
RPc41 <- sdmData(Occurrence~., train=guarah, predictors=predsPr,
               bg = list(method="gRandom", n=65, remove=TRUE))
RPc51 <- sdmData(Occurrence~., train=guarah, predictors=predsPl,
               bg = list(method="gRandom", n=65, remove=TRUE))

MRPc11 <- sdm(Occurrence~.,data=RPc11,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc21 <- sdm(Occurrence~.,data=RPc21,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc31 <- sdm(Occurrence~.,data=RPc31,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc41 <- sdm(Occurrence~.,data=RPc41,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc51 <- sdm(Occurrence~.,data=RPc51,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPc11),'auc', main="RF present")
plot(getVarImp(MRPc21),'auc', main="RF present")
plot(getVarImp(MRPc31),'auc', main="RF present")
plot(getVarImp(MRPc41),'auc', main="RF present")
plot(getVarImp(MRPc51),'auc', main="RF present")

#gui(MPc)
roc(MRPc1)
roc(MRPc2)
roc(MRPc3)
roc(MRPc4)
roc(MRPc5)
```

```{r}
names(PredictorsP)
PredictorH22<-dropLayer(PredictorsP, c(3:6,9,11,14,16,17,19:21,23:25,27:34,36,40,41))
names(PredictorH22)

```
```{r}

RPcy <- sdmData(Occurrence~., train=guarah, predictors=PredictorH22,
               bg = list(method="gRandom", n=65, remove=TRUE))
MRPcy <- sdm(Occurrence~.,data=RPcy,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPcy),'auc', main="RFresent")
vi8<-getVarImp(MRPcy)
vi8
roc(MRPcy)
```



O. parkeri
```{r}
RPc111 <- sdmData(Occurrence~., train=guarap, predictors=predsPc1,
               bg = list(method="gRandom", n=7, remove=TRUE))
RPc211 <- sdmData(Occurrence~., train=guarap, predictors=predsPt,
               bg = list(method="gRandom", n=7, remove=TRUE))
RPc311 <- sdmData(Occurrence~., train=guarap, predictors=predsPs,
               bg = list(method="gRandom", n=7, remove=TRUE))
RPc411 <- sdmData(Occurrence~., train=guarap, predictors=predsPr,
               bg = list(method="gRandom", n=7, remove=TRUE))
RPc511 <- sdmData(Occurrence~., train=guarap, predictors=predsPl,
               bg = list(method="gRandom", n=7, remove=TRUE))

MRPc111 <- sdm(Occurrence~.,data=RPc111,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc211 <- sdm(Occurrence~.,data=RPc211,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc311 <- sdm(Occurrence~.,data=RPc311,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc411 <- sdm(Occurrence~.,data=RPc411,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
MRPc511 <- sdm(Occurrence~.,data=RPc511,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPc111),'auc', main="RF present")
plot(getVarImp(MRPc211),'auc', main="RF present")
plot(getVarImp(MRPc311),'auc', main="RF present")
plot(getVarImp(MRPc411),'auc', main="RF present")
plot(getVarImp(MRPc511),'auc', main="RF present")

#gui(MPc)
roc(MRPc1)
roc(MRPc2)
roc(MRPc3)
roc(MRPc4)
roc(MRPc5)
```

```{r}
names(PredictorsP)
Predictorp22<-dropLayer(PredictorsP, c(5,11:13,16:21,23:26,28,29,31:34,36:41))
names(Predictorp22)
Predictorp23<-dropLayer(Predictorp22, c(1,4,5,8,9,10,12:15))
names(Predictorp23)


```

```{r}

RPcy2 <- sdmData(Occurrence~., train=guarap, predictors=Predictorp23,
               bg = list(method="gRandom", n=7, remove=TRUE))
MRPcy2 <- sdm(Occurrence~.,data=RPcy2,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MRPcy2),'auc', main="RF present")
vi9<-getVarImp(MRPcy2)
vi9
roc(MRPcy2)
```


Future RF
```{r}
DFc1 <- sdmData(Occurrence~., train=guarac2, predictors=predsF,
               bg = list(method="gRandom", n=10, remove=TRUE))
MFc1 <- sdm(Occurrence~.,data=DFc1,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFh1 <- sdmData(Occurrence~., train=guarah, predictors=predsF,
               bg = list(method="gRandom", n=65, remove=TRUE))
MFh1 <- sdm(Occurrence~.,data=DFh1,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
DFp1 <- sdmData(Occurrence~., train=guarap, predictors=predsF,
               bg = list(method="gRandom", n=7, remove=TRUE))
MFp1 <- sdm(Occurrence~.,data=DFp1,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
#MePc <- ensemble(MPc,newdata=PredictorsLC,filename='MxEnt_Present_OrnithodorosC.tif',setting=list(method='weighted',stat='TSS',opt=2))
plot(getVarImp(MFc1),'auc', main="rf future")
plot(getVarImp(MFh1),'auc', main="rf future")
plot(getVarImp(MFp1),'auc', main="rf future")
#gui(MPc)
roc(MFc1)
roc(MFh1)
roc(MFp1)
plot(getVarImp(MFc1),'auc', main="rf future")
rcurve(MFc1)
```


```{r}
names(PredictorF) 
PredictorRc<-dropLayer(PredictorF, c(12:41))
PredictorRc1<-dropLayer(PredictorF, c(12,13,14:16,18:41))
names(PredictorRc1)
PredictorRh<-dropLayer(PredictorF, c(3:6,9,11,14,16,17,19:21,23:25,27:34,36,40,41))
names(PredictorRh)
PredictorRp<-dropLayer(PredictorF, c(8,9,11,12,13,15:41))
names(PredictorRp)
```

```{r}
RFwc2 <- sdmData(Occurrence~., train=guarac2, predictors=PredictorRc1,
               bg = list(method="gRandom", n=15, remove=TRUE))
RFc1x2 <- sdm(Occurrence~.,data=RFwc2,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
roc(RFc1x2)
rcurve(RFc1x2)
```


```{r}
RFwc22 <- sdmData(Occurrence~., train=guarac2, predictors=PredictorRc1,
               bg = list(method="gRandom", n=15, remove=TRUE))
RFc1x22 <- sdm(Occurrence~.,data=RFwc22,methods=c('rf'),replication='cross',
           test.percent=20, n=15, parallelSettings=list(ncore=4,method="parallel"))
roc(RFc1x22)
rcurve(RFc1x22)
```



```{r}
RFwc <- sdmData(Occurrence~., train=guarac2, predictors=PredictorRc1,
               bg = list(method="gRandom", n=15, remove=TRUE))
RFc1x <- sdm(Occurrence~.,data=RFwc22,methods=c('rf'),replication='cross',
           test.percent=20, n=15, parallelSettings=list(ncore=4,method="parallel"))
RFwh <- sdmData(Occurrence~., train=guarah, predictors=PredictorRh,
               bg = list(method="gRandom", n=65, remove=TRUE))
RFh1x <- sdm(Occurrence~.,data=RFwh,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))
RFwp <- sdmData(Occurrence~., train=guarap, predictors=PredictorRp,
               bg = list(method="gRandom", n=7, remove=TRUE))
RFp1x <- sdm(Occurrence~.,data=RFwp,methods=c('rf'),replication='cross',
           test.percent=20, n=10, parallelSettings=list(ncore=4,method="parallel"))

plot(getVarImp(RFc1x),'auc', main="rf future")
plot(getVarImp(RFh1x),'auc', main="rf future")
plot(getVarImp(RFp1x),'auc', main="rf future")
vi10<-getVarImp(RFc1x)
vi11<-getVarImp(RFh1x)
vi12<-getVarImp(RFp1x)
vi10
vi11
vi12
roc(RFc1x)
roc(RFh1x)
roc(RFp1x)
rcurve(RFc1x)
```

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#Variables analysis
rocs 
```{r}
roc(MPcx)
roc(MPcy)
roc(MPcz)
roc(MFc1x)
roc(MFh1x)
roc(MFp1x)
roc(MRPcx)
roc(MRPcy)
roc(MRPcy2)
roc(RFc1x)
roc(RFh1x)
roc(RFp1x)
```


Final models sp-algorithm-conditions
```{r}

vi
rcurve(MPcx)

vi2
rcurve(MPcy)

vi3
rcurve(MPcz)

vi4
rcurve(MFc1x)

vi5
rcurve(MFh1x)

vi6
rcurve(MFp1x)

vi7
rcurve(MRPcx)

vi8
rcurve(MRPcy)

vi9
rcurve(MRPcy2)

vi10
rcurve(RFc1x)

vi11
rcurve(RFh1x)

vi12
rcurve(RFp1x)
```


```{r}
print(z11)
print(z21)
print(z31)
print(z41)
print(z51)
print(z61)
print(z71)
print(z81)
print(z91)
print(z101)
print(z111)
print(z121)
```



```{r}
vi
vi2
vi3
vi4
vi5
vi6
vi7
vi8
vi9
vi10
vi11
vi12
```

```{r}
# O. coriaceus - MaxEnt -Present
roc(MPcx)
vi
print(z11)
# O. hermsi - MaxEnt -Present
roc(MPcy)
vi2
print(z21)
# O. parkeri - MaxEnt -Present
roc(MPcz)
vi3
print(z31)
# O. coriaceus - MaxEnt -Future
roc(MFc1x)
vi4
print(z41)
# O. hermsi - MaxEnt -Future
roc(MFh1x)
vi5
print(z51)
# O. parkeri - MaxEnt -Future
roc(MFp1x)
vi6
print(z61)
# O. coriaceus - RF -Present
roc(MRPcx)
vi7
print(z71)
# O. hermsi - RF -Present
roc(MRPcy)
vi8
print(z81)
# O. parkeri - RF -Present
roc(MRPcy2)
vi9
print(z91)
# O. coriaceus - RF -Future
roc(RFc1x)
vi10
print(z101)
# O. hermsi - RF -Future
roc(RFh1x)
vi11
print(z111)
# O. parkeri - RF -Future
roc(RFp1x)
vi12
print(z121)
```


```{r}
roc(MPcx,main="Ornithodoros coriaceus MaxEnt Present")
roc(MPcy, main="Ornithodoros hermsi MaxEnt Present")
roc(MPcz, main="Ornithodoros parkeri MaxEnt Present")
roc(MFc1x, main="Ornithodoros coriaceus MaxEnt Future")
roc(MFh1x, main="Ornithodoros hermsi MaxEnt Future")
roc(MFp1x, main= "Ornithodoros parkeri MaxEnt Future")

roc(MRPcx,main="Ornithodoros coriaceus RandomForest Present")
roc(MRPcy,main="Ornithodoros hermsi RandomForest Present")
roc(MRPcy2,main="Ornithodoros parkeri RandomForest Present")
roc(RFc1x,main="Ornithodoros coriaceus RandomForest Future")
roc(RFh1x,main="Ornithodoros hermsi RandomForest Future")
roc(RFp1x,main="Ornithodoros parkeri RandomForest Future")
```

```{r}
plot(getVarImp(MPcx),'auc', main="Ornithodoros coriaceus MaxEnt Present")
plot(getVarImp(MPcy),'auc', main="Ornithodoros hermsi MaxEnt Present")
plot(getVarImp(MPcz),'auc', main="Ornithodoros parkeri MaxEnt Present")
plot(getVarImp(MFc1x),'auc', main="Ornithodoros coriaceus MaxEnt Future")
plot(getVarImp(MFh1x),'auc', main="Ornithodoros hermsi MaxEnt Future")
plot(getVarImp(MFp1x),'auc', main="Ornithodoros parkeri MaxEnt Future")
plot(getVarImp(MRPcx),'auc', main="Ornithodoros coriaceus RandomForest Present")
plot(getVarImp(MRPcy),'auc', main="Ornithodoros hermsi RandomForest Present")
plot(getVarImp(MRPcy2),'auc', main="Ornithodoros parkeri RandomForest Present")

plot(getVarImp(RFc1x),'auc', main="Ornithodoros coriaceus RandomForest Future")
plot(getVarImp(RFh1x),'auc', main="Ornithodoros hermsi RandomForest Future")
plot(getVarImp(RFp1x),'auc', main="Ornithodoros parkeri RandomForest Future")

```


```{r}

rcurve(MPcx,main="Ornithodoros coriaceus MaxEnt Present")
rcurve(MPcy, main="Ornithodoros hermsi MaxEnt Present")
rcurve(MPcz, main="Ornithodoros parkeri MaxEnt Present")
rcurve(MFc1x,main="Ornithodoros coriaceus MaxEnt Future")
rcurve(MFh1x, main="Ornithodoros hermsi MaxEnt Future")
rcurve(MFp1x,main="Ornithodoros parkeri MaxEnt Future")

rcurve(MRPcx,main="Ornithodoros coriaceus RandomForest Present")
rcurve(MRPcy,main="Ornithodoros hermsi RandomForest Present")
rcurve(MRPcy2,main="Ornithodoros parkeri RandomForest Present")
rcurve(RFc1x,main="Ornithodoros coriaceus RandomForest Future")
rcurve(RFh1x,main="Ornithodoros hermsi RandomForest Future")
rcurve(RFp1x,main="Ornithodoros parkeri RandomForest Future")
```


```{r}
vi
print(z11)

rcurve(MPcx)


vi2
print(z21)

rcurve(MPcy)


vi3
print(z31)

rcurve(MPcz)


vi4
print(z41)
rcurve(MFc1x)
print(z41)

vi5
print(z51)
rcurve(MFh1x)


vi6
print(z61)
rcurve(MFp1x)

vi7
print(z71)
rcurve(MRPcx)

vi8
print(z81)
rcurve(MRPcy)

vi9
print(z91)
rcurve(MRPcy2)

vi10
print(z101)
rcurve(RFc1x)

vi11
print(z111)
rcurve(RFh1x)

vi12
print(z121)
rcurve(RFp1x)
```



```{r}
rcurve(MPcx)
rcurve(MPcy)
rcurve(MPcz)
rcurve(MFc1x)
rcurve(MFh1x)
rcurve(MFp1x)
rcurve(MRPcx)
rcurve(MRPcy)
rcurve(MRPcy2)
rcurve(RFc1x)
rcurve(RFh1x)
rcurve(RFp1x)

```





----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#Binomial maps
We need to transform the distribution from suitability to presence/absence

##Ensemble tiffs model def
```{r}
MP_C <- ensemble(MPcx,newdata=PredictorsP,filename='MxEnt_Present_OrnithodorosCx.tif',setting=list(method='weighted',stat='TSS',opt=2))
MP_H <- ensemble(MPcy,newdata=PredictorH2,filename='MxEnt_Present_OrnithodorosHx.tif',setting=list(method='weighted',stat='TSS',opt=2))
MP_P <- ensemble(MPcz,newdata=Predictorp2,filename='MxEnt_Present_OrnithodorosPx.tif',setting=list(method='weighted',stat='TSS',opt=2))

RP_C<- ensemble( MRPcx,newdata=PPm1,filename='RF_Present_OrnithodorosCx.tif',setting=list(method='weighted',stat='TSS',opt=2))
RP_H <- ensemble(MRPcy,newdata=PredictorH22,filename='RF_Present_OrnithodorosHx.tif',setting=list(method='weighted',stat='TSS',opt=2))
RP_P  <- ensemble( MRPcy2,newdata=Predictorp23,filename='RF_Present_OrnithodorosPx.tif',setting=list(method='weighted',stat='TSS',opt=2))

MF_C<- ensemble(MFc1x,newdata=PredictorsF,filename='MxEnt_Future_OrnithodorosCx.tif',setting=list(method='weighted',stat='TSS',opt=2),overwrite=TRUE)
MF_H<- ensemble( MFh1x,newdata=PredictorFh,filename='MxEnt_Future_OrnithodorosHx.tif',setting=list(method='weighted',stat='TSS',opt=2))
MF_P<- ensemble(MFp1x,newdata=PredictorFp,filename='MxEnt_Future_OrnithodorosPx.tif',setting=list(method='weighted',stat='TSS',opt=2))

RF_C <- ensemble(RFc1x,newdata=PredictorRc1,filename='RF_Future_OrnithodorosCx.tif',setting=list(method='weighted',stat='TSS',opt=2))
RF_H <- ensemble(RFh1x,newdata=PredictorRh,filename='RF_Future_OrnithodorosHx.tif',setting=list(method='weighted',stat='TSS',opt=2))
RF_P <- ensemble(RFp1x,newdata=PredictorRp,filename='RF_Future_OrnithodorosPx.tif',setting=list(method='weighted',stat='TSS',opt=2))


```

##Threshold selection (TSS) for binomial map (absence/presence based on TSS)
```{r}
#Maxent present
z1<-getEvaluation(MPcx, stat = 'threshold')
z11<-mean(z1$threshold)
z2<-getEvaluation(MPcy, stat = 'threshold')
z21<-mean(z2$threshold)
z3<-getEvaluation(MPcz, stat = 'threshold')
z31<-mean(z3$threshold)

MePcx1<-MP_C
presoccur<-ifelse(values(MePcx1)>=z11,1,0)
values(MePcx1)=presoccur
plot(MePcx1)
MePhx1<-MP_H
presoccur<-ifelse(values(MePhx1)>=z21,1,0)
values(MePhx1)=presoccur
plot(MePhx1)
MePpx1<-MP_P
presoccur<-ifelse(values(MePpx1)>=z31,1,0)
values(MePpx1)=presoccur
plot(MePpx1)

#Rf present
z4<-getEvaluation(MRPcx, stat = 'threshold')
z41<-mean(z4$threshold)
z5<-getEvaluation(MRPcy, stat = 'threshold')
z51<-mean(z5$threshold)
z6<-getEvaluation(MRPcy2, stat = 'threshold')
z61<-mean(z6$threshold)

RePcxx<-RP_C
presoccur<-ifelse(values(RePcxx)>=z41,1,0)
values(RePcxx)=presoccur
plot(RePcxx)
RePhxx<-RP_H
presoccur<-ifelse(values(RePhxx)>=z51,1,0)
values(RePhxx)=presoccur
plot(RePhxx)
RePpxx<-RP_P
presoccur<-ifelse(values(RePpxx)>=z61,1,0)
values(RePpxx)=presoccur
plot(RePpxx)

#Maxent future
z7<-getEvaluation(MFc1x, stat = 'threshold')
z71<-mean(z7$threshold)
z8<-getEvaluation(MFh1x, stat = 'threshold')
z81<-mean(z8$threshold)
z9<-getEvaluation(MFp1x, stat = 'threshold')
z91<-mean(z9$threshold)


MeFcx1<-MF_C
presoccur<-ifelse(values(MeFcx1)>=z71,1,0)
values(MeFcx1)=presoccur
plot(MeFcx1)
MeFhx1<-MF_H
presoccur<-ifelse(values(MeFhx1)>=z81,1,0)
values(MeFhx1)=presoccur
plot(MeFhx1)
MeFpx1<-MF_P
presoccur<-ifelse(values(MeFpx1)>=z91,1,0)
values(MeFpx1)=presoccur
plot(MeFpx1)

#RF future
z10<-getEvaluation(RFc1x, stat = 'threshold')
z101<-mean(z10$threshold)
z11<-getEvaluation(RFh1x, stat = 'threshold')
z111<-mean(z11$threshold)
z12<-getEvaluation(RFp1x, stat = 'threshold')
z121<-mean(z12$threshold)

ReFcx1<-RF_C
presoccur<-ifelse(values(ReFcx1)>=z101,1,0)
values(ReFcx1)=presoccur
plot(ReFcx1)
ReFhx1<-RF_H
presoccur<-ifelse(values(ReFhx1)>=z111,1,0)
values(ReFhx1)=presoccur
plot(ReFhx1)
ReFpx1<-RF_P
presoccur<-ifelse(values(ReFpx1)>=z121,1,0)
values(ReFpx1)=presoccur
plot(ReFpx1)
```
```{r}
#Maxent present
MPx<-MePcx1+MePhx1+MePpx1
RPxx<-RePcxx+RePhxx+RePpxx
#Future
MFx<-MeFcx1+MeFhx1+MeFpx1
RFx<-ReFcx1+ReFhx1+ReFpx1


MRPxx<-MPx+RPxx
MRFx<-MFx+RFx

plot(MePcx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros coriaceus"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(MePhx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros hermsi"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
plot(MePpx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros parkeri"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
############################################################################################
plot(RePcxx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros coriaceus"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(RePhxx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros hermsi"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
plot(RePpxx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros parkeri"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
#############################################################################

plot(MeFcx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros coriaceus"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(MeFhx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros hermsi"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
plot(MeFpx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros parkeri"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
########################################################################################

plot(ReFcx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros coriaceus"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(ReFhx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros hermsi"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
plot(ReFpx1, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros parkeri"))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
###########################################################################################

plot(MPx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(RPxx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
#############################################################################################
plot(MFx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - MaxEnt - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))
plot(RFx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - RandomForest - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))


```





##Merging the sp 
```{r}
#Present
MPx<-MePcx1+MePhx1+MePpx1
presoccur<-ifelse(values(MPx)>0.5,1,0)
values(MPx)=presoccur
plot(MPx)
RPxx<-RePcxx+RePhxx+RePpxx
presoccur<-ifelse(values(RPxx)>0.5,1,0)
values(RPxx)=presoccur
plot(RPxx)

#Future
MFx<-MeFcx1+MeFhx1+MeFpx1
presoccur<-ifelse(values(MFx)>0.5,1,0)
values(MFx)=presoccur
plot(MFx)
RFx<-ReFcx1+ReFhx1+ReFpx1
presoccur<-ifelse(values(RFx)>0.5,1,0)
values(RFx)=presoccur
plot(RFx)

```

##Merging Maxent-RF only shared areas of binomial map
```{r}

MRPxx<-MPx+RPxx
presoccur<-ifelse(values(MRPxx)>1.1,1,0)
values(MRPxx)=presoccur
plot(MRPxx)
MRFx<-MFx+RFx
presoccur<-ifelse(values(MRFx)>1.1,1,0)
values(MRFx)=presoccur
plot(MRFx)

plot(MRPxx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

plot(MRFx, col=c('dodgerblue4', 'seagreen3'), main=" Predicted habitat - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Unsuitable habitat", "Suitable habitat"), fill=c('dodgerblue4', 'seagreen3'))

```

```{r}
mapview(stack(MRPxx,MRFx))
```


```{r}


# Convert the raster to a data frame
DifPFO2_df <- as.data.frame(DifPFO2, xy=TRUE)

# Assign names to the data frame
names(DifPFO2_df) <- c("longitude", "latitude", "value")

# Transform value into a factor
DifPFO2_df$value <- factor(DifPFO2_df$value, levels = c(-1, 0, 1), labels = c("Extinction","No change", "Colonization"))

# Plot using ggplot2
ggplot(DifPFO2_df, aes(x = longitude, y = latitude, fill = value)) +
  geom_tile() +
  scale_fill_manual(values = c("blue", 'gray20', 'red3'), name = as.expression(bquote(italic("Ornithodoros spp.")))) +
  coord_quickmap() +
  theme_minimal() +
  labs(title = "Suitability area - Temporal trend", x = "Longitude", y = "Latitude")

```

```{r}
DifPFO2<- MRFx - MRPxx 
```


```{r}
plot(DifPFO2, col=c('gold', 'dodgerblue4', 'red3'), main=" Suitability area - Temporal trend", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Extinction","No change", "Colonization"), fill=c('gold', 'dodgerblue4', 'red3'))# 1 is expansion, 0 no change, -1 extintion
```



```{r}


# Your rasters
raster_present <- MRPxx
raster_future <- MRFx

# Calculate the cell size (0.5km * 0.5km = 0.25 km^2)
cell_size_km <- (0.5 * 0.5)

# Replace NA values with 0
raster_present[is.na(raster_present)] <- 0
raster_future[is.na(raster_future)] <- 0

# Calculate the total number of cells representing presence (value=1)
n_cells_present <- sum(values(raster_present) == 1, na.rm = TRUE)
n_cells_future <- sum(values(raster_future) == 1, na.rm = TRUE)

# Calculate the total area
area_present_km2 <- n_cells_present * cell_size_km
area_future_km2 <- n_cells_future * cell_size_km

# Calculate the difference in area
area_diff_km2 <- area_future_km2 - area_present_km2

# Print the results
print(paste("Present habitat area: ", area_present_km2, "km^2"))
print(paste("Future habitat area: ", area_future_km2, "km^2"))
print(paste("Area difference: ", area_diff_km2, "km^2"))


```


To see big plots in R
```{r}
par(mar=c(3,2.5,2.5,2))

```

swine part
```{r}
SusMaxEnt<- raster("SUSMaxEnt.tif")
Susfarms<- raster("SUSfarm.tif")
plot(Susfarms)

SusMaxEnt1<-SusMaxEnt
presoccur<-ifelse(values(SusMaxEnt1)>0.5,2,0)
values(SusMaxEnt1)=presoccur
plot(SusMaxEnt1, col=c ('gray','green4'), main = "Predicted suitable habitat", legend=FALSE)
legend("topright", title="Feral swine", inset = c(-0.0, 0), xpd=TRUE,
       c("Absence","Presence"), fill=c('gray', 'green4'))


presoccur<-ifelse(values(Susfarms)>0.5,2,0)
values(Susfarms)=presoccur
plot(Susfarms, col=c( 'gray', 'green4'), main = " Outdoor-raised pig operations", legend=FALSE)
legend("topright", title="OPO", inset = c(- 0.0, 0),xpd=T,
       c("Absence","Presence"), fill=c('gray', 'green4'))

SusdefP<-Susfarms+SusMaxEnt1
presoccur<-ifelse(values(SusdefP)>0.5,2,0)
values(SusdefP)=presoccur
plot(SusdefP, col=c( 'gray', 'green4'), main = "Sus scrofa Predicted distribution", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Sus scrofa"))), inset = c(- 0.0, 0),xpd=T,
       c("Absence","Presence"), fill=c('gray', 'green4'))

plot(SusdefP, col=c('dodgerblue4', 'gold'), main=" Feral pig and OPO distribution", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Sus scrofa"))), inset = c(- 0.0, 0),xpd=T,
       c("Absence","Presence"), fill=c('dodgerblue4', 'gold'))

```


Overlapping
```{r}
OSOverlapP5<-MRPxx  + SusdefP
OSOverlapF5<- MRFx  + SusdefP
OSOverlapP5X<-OSOverlapP5
presoccur<-ifelse(values(OSOverlapP5X)>2.1,1,0)
values(OSOverlapP5X)=presoccur
OSOverlapF5X<-OSOverlapF5
presoccur<-ifelse(values(OSOverlapF5X)>2.1,1,0)
values(OSOverlapF5X)=presoccur

#'gold', 'dodgerblue4', 'red3 , 'seagreen3'
COMPLETEverlapChange<-OSOverlapF5X-OSOverlapP5X 

plot(OSOverlapP5, col=c('dodgerblue4', 'seagreen3', 'goldenrod2', 'red3'), main="Overlapping area - Present", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Sus scrofa-Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Absence",as.expression(bquote(italic("Ornithodoros spp."))),as.expression(bquote(italic("Sus scrofa"))), "Overlapping area"), fill=c('dodgerblue4', 'seagreen3', 'goldenrod2', 'red3'))

plot(OSOverlapF5, col=c('dodgerblue4', 'seagreen3', 'goldenrod2', 'red3'), main="Overlapping area - Future", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Sus scrofa-Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("Absence",as.expression(bquote(italic("Ornithodoros spp."))),as.expression(bquote(italic("Sus scrofa"))), "Overlapping area"), fill=c('dodgerblue4', 'seagreen3', 'goldenrod2', 'red3'))

plot(COMPLETEverlapChange, col=c('gold', 'dodgerblue4', 'red3'), main=" Overlapping area - Temporal trend", legend=FALSE)
legend("topright", title=as.expression(bquote(italic("Sus scrofa-Ornithodoros spp."))), inset = c(- 0.0, 0),xpd=T,
       c("End of overlap","No change", "New overlapping areas"), fill=c('gold', 'dodgerblue4', 'red3'))

```



```{r}
# Calculate the area of overlap in present
overlap_present <- sum(values(OSOverlapP5X) == 1, na.rm = TRUE)
area_overlap_present_km2 <- overlap_present * 0.25

# Calculate the area of overlap in future
overlap_future <- sum(values(OSOverlapF5X) == 1, na.rm = TRUE)
area_overlap_future_km2 <- overlap_future * 0.25

# Calculate the difference in overlap areas
overlap_diff <- overlap_future - overlap_present
area_overlap_diff_km2 <- overlap_diff * 0.25

# Print the results
print(paste("Present overlap area: ", area_overlap_present_km2, "km^2"))
print(paste("Future overlap area: ", area_overlap_future_km2, "km^2"))
print(paste("Overlap area difference: ", area_overlap_diff_km2, "km^2"))

```

